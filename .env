# =============================================================================
#  Forgejo + Woodpecker Docker – Fichier .env.example
#  Instructions :
#  1. Copiez ce fichier en .env (cp .env.example .env)
#  2. Remplissez les valeurs sensibles (secrets, mots de passe, etc.)
#  3. Ajoutez .env à votre .gitignore pour ne jamais le commiter !
#  4. Lancez : docker compose up -d
# =============================================================================

# ──────────────────────────────────────────────
#  SECTION FORGEJO – Configuration générale
# ──────────────────────────────────────────────

# Domaine ou IP publique de Forgejo (pour les URLs générées dans l'interface)
# Exemples : localhost (test local), forgejo.votredomaine.com, 192.168.1.192
FORGEJO_DOMAIN=localhost

# Port HTTP externe (visible depuis votre navigateur)
# Par défaut 5333 pour éviter le conflit avec le port 3000 interne
FORGEJO_HTTP_PORT=5333

# URL complète accessible depuis le navigateur (terminer obligatoirement par /)
# Exemple : http://192.168.1.192:5333/
FORGEJO_ROOT_URL=http://\( {FORGEJO_DOMAIN}: \){FORGEJO_HTTP_PORT}/

# Port SSH externe (utilisé pour git clone ssh://...)
# Changez si 22 est déjà utilisé sur votre machine
FORGEJO_SSH_PORT=5222

# Port interne HTTP de Forgejo (dans le conteneur) – NE CHANGEZ PAS sauf raison forte
FORGEJO_INTERNAL_PORT=3000

# Type de base de données (sqlite3 est parfait pour < 100 utilisateurs)
# Autres options : mysql, postgres, mssql
FORGEJO_DB_TYPE=sqlite3

# Chemin de la base SQLite dans le conteneur – NE CHANGEZ PAS
FORGEJO_DB_PATH=/data/git/forgejo.db

# UID/GID de l'utilisateur git dans le conteneur (pour ownership volumes)
# 1000:1000 est la valeur par défaut de Forgejo
FORGEJO_USER_UID=1000
FORGEJO_USER_GID=1000

# ──────────────────────────────────────────────
#  SECTION SMTP – Envoi d'emails (notifications, reset password, etc.)
# ──────────────────────────────────────────────

# Activer ou désactiver l'envoi d'emails
# false = pas d'emails (par défaut au démarrage)
# true = emails activés (remplissez les lignes suivantes)
FORGEJO_MAILER_ENABLED=false

# Serveur SMTP (exemples : smtp.zoho.eu, smtp.gmail.com, smtp.mailbox.org)
FORGEJO_MAILER_HOST=smtp.mailbox.org

# Port SMTP
# 465 = SMTPS (SSL) – recommandé pour Zoho
# 587 = STARTTLS – alternative si 465 bloqué
FORGEJO_MAILER_PORT=465

# Adresse email expéditeur (doit être valide sur votre fournisseur)
FORGEJO_MAILER_FROM=forgejo@example.com

# Utilisateur SMTP (souvent la même adresse que FROM)
FORGEJO_MAILER_USER=

# Mot de passe SMTP
# IMPORTANT : pour Zoho, Gmail, etc. → utilisez un APP PASSWORD (pas le mot de passe principal !)
FORGEJO_MAILER_PASSWD=

# Utiliser STARTTLS (port 587) au lieu de SSL direct (port 465)
FORGEJO_MAILER_USE_STARTTLS=true

# Utiliser SSL direct (port 465)
FORGEJO_MAILER_USE_SSL=false

# Nom de domaine HELO/EHLO envoyé au serveur SMTP (optionnel)
# Laissez vide sauf si votre fournisseur l'exige
FORGEJO_MAILER_HELO_HOSTNAME=

# ──────────────────────────────────────────────
#  SECTION WOODPECKER – Configuration générale
# ──────────────────────────────────────────────

# URL publique de Woodpecker (utilisée pour OAuth redirect et webhooks)
# Doit être accessible depuis votre navigateur
# Exemple : http://192.168.1.192:5444 ou https://ci.votredomaine.com
WOODPECKER_HOST=http://localhost:5444

# Port externe HTTP de Woodpecker
WOODPECKER_HTTP_PORT=5444

# Activer l'intégration Forgejo (obligatoire)
WOODPECKER_FORGEJO=true

# URL interne de Forgejo (utilisée par Woodpecker pour API/clone)
# Ne changez pas sauf si vous renommez le service forgejo
WOODPECKER_FORGEJO_URL=http://forgejo:3000

# Adresse d'écoute du serveur Woodpecker (0.0.0.0 = toutes interfaces)
WOODPECKER_SERVER_ADDR=0.0.0.0:8000

# Niveau de logs (info par défaut, debug pour dépanner)
WOODPECKER_LOG_LEVEL=info

# ──────────────────────────────────────────────
#  SECTION SECRETS – À REMPLIR OBLIGATOIREMENT
# ──────────────────────────────────────────────

# Secret partagé entre Woodpecker-server et woodpecker-agent
# Doit être IDENTIQUE sur les deux services
# Générez-le avec : openssl rand -base64 48
WOODPECKER_AGENT_SECRET=change-me-long-random-secret-min-48-chars

# OAuth2 Client ID et Client Secret pour l'intégration Forgejo
# Étapes pour les obtenir :
# 1. http://localhost:5333 → créer compte admin
# 2. Avatar → Settings → Applications → New OAuth2 Application
# 3. Nom : Woodpecker CI
# 4. Redirect URI : ${WOODPECKER_HOST}/authorize (ex: http://localhost:5444/authorize)
# 5. Scope : coche tout ou au moins repo,user:email,read:org
# 6. Créez → copiez Client ID et Client Secret ici
WOODPECKER_FORGEJO_CLIENT=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
WOODPECKER_FORGEJO_SECRET=yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy

# ──────────────────────────────────────────────
#  OPTIONS SUPPLÉMENTAIRES (décommenter si besoin)
# ──────────────────────────────────────────────

# Autoriser l'inscription ouverte sur Woodpecker (tous les users Forgejo peuvent se connecter)
# WOODPECKER_OPEN=true

# Limite de workflows simultanés par agent
# WOODPECKER_MAX_WORKFLOWS=2

# Chemin de base pour tous les volumes persistants (optionnel)
# VOLUMES_BASE=/*your directory/Docker_Forgejo_Woodpecker/volume_docker_Forgejo-Woodpecker