# =============================================================================
#  Forgejo + Woodpecker Docker - Fichier .env
#  Instructions importantes : NE JAMAIS commiter ce fichier sur GitHub !
#  Copie ce fichier en local, remplis les valeurs sensibles, et ajoute .env à .gitignore
# =============================================================================

# ──────────────────────────────────────────────
#  CONFIGURATION FORGEJO
# ──────────────────────────────────────────────

# Domaine ou IP publique (pour les URLs générées dans Forgejo)
FORGEJO_DOMAIN=localhost

# Port HTTP externe visible depuis ton navigateur
FORGEJO_HTTP_PORT=5333

# URL complète accessible depuis le navigateur (terminer par /)
FORGEJO_ROOT_URL=http://\( {FORGEJO_DOMAIN}: \){FORGEJO_HTTP_PORT}/

# Port SSH externe (pour git clone ssh://...)
SSH_PORT=5222

# Type de base de données (sqlite3 est parfait pour < 50-100 utilisateurs)
FORGEJO_DB_TYPE=sqlite3
FORGEJO_DB_PATH=/data/git/forgejo.db


# ──────────────────────────────────────────────
#  CONFIGURATION WOODPECKER CI
# ──────────────────────────────────────────────

# URL externe de Woodpecker (navigateur) – IMPORTANT pour OAuth redirect
WOODPECKER_HOST=http://localhost:5444

# Port externe Woodpecker
WOODPECKER_HTTP_PORT=5444


# ──────────────────────────────────────────────
#  INTÉGRATION FORGEJO → WOODPECKER (obligatoire)
# ──────────────────────────────────────────────

# Activer le driver Forgejo (recommandé depuis 2024-2025)
WOODPECKER_FORGEJO=true

# URL interne (dans le réseau Docker)
WOODPECKER_FORGEJO_URL=http://forgejo:3000


# ──────────────────────────────────────────────
#  SECRETS – À REMPLIR OBLIGATOIREMENT
# ──────────────────────────────────────────────

# Secret partagé entre Woodpecker server et agent (32+ caractères aléatoires)
# Génération rapide : openssl rand -base64 48
WOODPECKER_AGENT_SECRET=change-me-immediatement-avant-de-lancer

# OAuth2 Client ID et Secret → À obtenir dans Forgejo après premier démarrage
# Étapes :
# 1. http://localhost:5333 → créer compte admin
# 2. Avatar → Applications → Nouvelle application OAuth2
# 3. Nom : Woodpecker CI
# 4. Redirect URI : ${WOODPECKER_HOST}/authorize   (ex: http://localhost:5444/authorize)
# 5. Scope : repo, user:email, read:org (ou tout cocher si simple)
# 6. Copier ici Client ID et Client Secret
WOODPECKER_FORGEJO_CLIENT=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
WOODPECKER_FORGEJO_SECRET=yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy


# ──────────────────────────────────────────────
#  OPTIONS SUPPLÉMENTAIRES (décommenter si besoin)
# ──────────────────────────────────────────────

# Permettre l'inscription ouverte sur Woodpecker
# WOODPECKER_OPEN=true

# Niveau de log plus détaillé (utile au début)
# WOODPECKER_LOG_LEVEL=debug

# Nombre max de workflows simultanés par agent
# WOODPECKER_MAX_WORKFLOWS=2