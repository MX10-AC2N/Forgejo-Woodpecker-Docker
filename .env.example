# =============================================================================
# Configuration Forgejo + Woodpecker CI
# =============================================================================
# Copiez ce fichier vers .env et personnalisez les valeurs
# cp .env.example .env

# =============================================================================
# FORGEJO - Git Forge
# =============================================================================

# Domaine public de Forgejo
FORGEJO_DOMAIN=localhost

# Port HTTP externe pour Forgejo
FORGEJO_HTTP_PORT=5333

# URL racine complète (doit correspondre au domaine + port)
FORGEJO_ROOT_URL=http://localhost:5333/

# Port SSH pour Git (externe)
FORGEJO_SSH_PORT=5222

# Port interne du conteneur (NE PAS MODIFIER)
FORGEJO_INTERNAL_PORT=3000

# Type de base de données (sqlite3 recommandé pour petit/moyen usage)
FORGEJO_DB_TYPE=sqlite3

# Chemin de la base SQLite (à l'intérieur du conteneur)
FORGEJO_DB_PATH=/data/gitea/forgejo.db

# Activer le serveur mail (false pour tests/dev)
FORGEJO_MAILER_ENABLED=false

# =============================================================================
# WOODPECKER CI - Continuous Integration
# =============================================================================

# Version de Woodpecker (synchroniser server et agent)
WOODPECKER_VERSION=v2.7.1-alpine

# URL publique de Woodpecker (utilisée pour OAuth callback)
# ⚠️ IMPORTANT : Doit être accessible depuis le navigateur ET depuis Forgejo
WOODPECKER_HOST=http://localhost:5444

# Port HTTP externe pour Woodpecker
WOODPECKER_HTTP_PORT=5444

# URL interne de Forgejo (pour communication inter-conteneurs)
WOODPECKER_FORGEJO_URL=http://forgejo:3000

# Activer l'intégration Forgejo
WOODPECKER_FORGEJO=true

# Permettre la création de compte sans invitation (pour tests)
WOODPECKER_OPEN=true

# Niveau de log (debug, info, warn, error)
WOODPECKER_LOG_LEVEL=info

# Nombre max de workflows en parallèle
WOODPECKER_MAX_WORKFLOWS=2

# =============================================================================
# SECRETS - ⚠️ À PERSONNALISER ABSOLUMENT ! ⚠️
# =============================================================================

# Secret partagé entre Woodpecker Server et Agent
# ⚠️ MINIMUM 48 caractères aléatoires
# Générer avec : openssl rand -base64 48
WOODPECKER_AGENT_SECRET=CHANGEZ_MOI_secret_minimum_48_caracteres_requis_exemple_abc123def456ghi789jkl

# =============================================================================
# ADMIN - Utilisateur administrateur Forgejo
# =============================================================================

# Nom d'utilisateur admin
ADMIN_USERNAME=forgejo-admin

# ⚠️ Mot de passe admin - CHANGEZ-LE !
# Doit contenir : majuscules, minuscules, chiffres, caractères spéciaux
ADMIN_PASSWORD=ChangeMe123!SecurePassword

# Email de l'admin
ADMIN_EMAIL=admin@forgejo.local

# Nom complet de l'admin
ADMIN_FULLNAME=Administrator

# =============================================================================
# OAUTH - Credentials auto-générés (NE PAS MODIFIER)
# =============================================================================
# Ces variables sont automatiquement remplies par first-run-init.sh
# Laissez-les vides, elles seront configurées au premier démarrage

WOODPECKER_FORGEJO_CLIENT=
WOODPECKER_FORGEJO_SECRET=

# =============================================================================
# VOLUMES - Stockage des données
# =============================================================================

# Répertoire de base pour tous les volumes
# Défaut : ./volumes (données dans le projet)
# Production : chemin absolu comme /opt/forgejo-woodpecker/data
VOLUMES_BASE=./volumes

# =============================================================================
# NOTES IMPORTANTES
# =============================================================================
# 
# 1. SÉCURITÉ EN PRODUCTION :
#    - Changez ADMIN_PASSWORD avec un mot de passe fort
#    - Générez un nouveau WOODPECKER_AGENT_SECRET aléatoire (48+ chars)
#    - Utilisez HTTPS avec un reverse proxy (Traefik, Nginx, Caddy)
#    - Ne committez JAMAIS ce fichier .env avec vos secrets !
#
# 2. OAUTH AUTOMATIQUE :
#    - Laissez WOODPECKER_FORGEJO_CLIENT et SECRET vides
#    - Ils seront auto-générés au premier démarrage
#    - Les credentials sont sauvegardés dans /shared/oauth-credentials.env
#
# 3. PORTS :
#    - Forgejo HTTP : 5333 (externe) → 3000 (interne)
#    - Forgejo SSH  : 5222 (externe) → 22 (interne)
#    - Woodpecker   : 5444 (externe) → 8000 (interne)
#    - Modifiez si conflit avec services existants
#
# 4. VOLUMES :
#    - Les données sont dans ./volumes/ par défaut
#    - Sauvegardez ce dossier pour backup
#    - Ou utilisez un chemin absolu pour VOLUMES_BASE
#
# 5. HEALTHCHECKS :
#    - Forgejo    : curl http://localhost:5333/api/healthz
#    - Woodpecker : curl http://localhost:5444/healthz
#
# 6. VALIDATION :
#    - Après démarrage : ./scripts/validate-stack.sh
#
# =============================================================================