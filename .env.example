# =============================================================================
#  Forgejo + Woodpecker Docker – Fichier .env.example
#  Instructions pour tester ou déployer :
#  1. cp .env.example .env
#  2. Remplissez au moins les secrets (WOODPECKER_AGENT_SECRET + OAuth)
#  3. Ajoutez .env dans .gitignore
#  4. docker compose build --no-cache
#  5. docker compose up -d
# =============================================================================

# ─── FORGEJO ────────────────────────────────────────────────────────────────

# Domaine ou IP publique (pour les URLs générées par Forgejo)
# Pour tests locaux : localhost
# Pour serveur réel : forgejo.votredomaine.com ou votre IP
FORGEJO_DOMAIN=localhost

# Port HTTP externe (visible dans le navigateur)
FORGEJO_HTTP_PORT=5333

# URL complète accessible depuis le navigateur (terminer par /)
FORGEJO_ROOT_URL=http://localhost:5333/

# Port SSH externe (pour git clone ssh://...)
FORGEJO_SSH_PORT=5222

# Port interne HTTP de Forgejo dans le conteneur (ne changez pas sauf raison forte)
FORGEJO_INTERNAL_PORT=3000

# Type de base de données (sqlite3 est idéal pour tests et petits usages)
FORGEJO_DB_TYPE=sqlite3

# Chemin de la DB SQLite dans le conteneur (ne changez pas)
FORGEJO_DB_PATH=/data/git/forgejo.db

# UID/GID de l'utilisateur git dans le conteneur (valeur par défaut Forgejo)
FORGEJO_USER_UID=1000
FORGEJO_USER_GID=1000

# ─── SMTP (emails Forgejo : notifications, reset password, invitations…)
# ───────────────────────────────────────────────────────────────────────────

# Activer l'envoi d'emails ?
# false = emails désactivés (par défaut)
# true = emails activés → remplissez les lignes suivantes
FORGEJO_MAILER_ENABLED=false

# Serveur SMTP (exemples : smtp.zoho.eu, smtp.gmail.com, smtp.mailbox.org)
FORGEJO_MAILER_HOST=smtp.mailbox.org

# Port SMTP
# 465 = SSL/TLS (recommandé pour Zoho)
# 587 = STARTTLS (alternative si 465 bloqué)
FORGEJO_MAILER_PORT=465

# Adresse email expéditeur (doit exister chez votre fournisseur)
FORGEJO_MAILER_FROM=forgejo@exemple.com

# Utilisateur SMTP (souvent identique à FROM)
FORGEJO_MAILER_USER=

# Mot de passe SMTP
# IMPORTANT : utilisez un APP PASSWORD (Zoho/Gmail/etc.) – PAS le mot de passe normal
FORGEJO_MAILER_PASSWD=

# Activer STARTTLS (recommandé pour port 587)
FORGEJO_MAILER_USE_STARTTLS=true

# Activer SSL direct (recommandé pour port 465)
FORGEJO_MAILER_USE_SSL=false

# Nom HELO/EHLO envoyé au serveur SMTP (optionnel, laissez vide si pas requis)
FORGEJO_MAILER_HELO_HOSTNAME=

# ─── WOODPECKER ─────────────────────────────────────────────────────────────

# Version de Woodpecker à utiliser (fixée pour stabilité)
WOODPECKER_VERSION=v2.7.1-alpine

# URL publique de Woodpecker (utilisée pour OAuth redirect et affichage)
# Pour tests locaux : http://localhost:5444
# Pour serveur : http://192.168.1.192:5444 ou https://ci.votredomaine.com
WOODPECKER_HOST=http://localhost:5444

# Port externe HTTP de Woodpecker
WOODPECKER_HTTP_PORT=5444

# Activer l'intégration Forgejo (obligatoire)
WOODPECKER_FORGEJO=true

# URL interne de Forgejo (utilisée par Woodpecker pour API/clone)
# Ne changez pas sauf si vous renommez le service forgejo
WOODPECKER_FORGEJO_URL=http://forgejo:3000

# Adresse d'écoute interne du serveur Woodpecker (ne changez pas)
WOODPECKER_SERVER_ADDR=0.0.0.0:8000

# Niveau de logs (info = normal, debug = plus verbeux pour dépanner)
WOODPECKER_LOG_LEVEL=info

# Autoriser les inscriptions ouvertes sur Woodpecker ?
# true = tout utilisateur Forgejo peut se connecter sans invitation
WOODPECKER_OPEN=true

# Nombre maximum de workflows simultanés par agent
WOODPECKER_MAX_WORKFLOWS=2

# ─── SECRETS – À REMPLIR OBLIGATOIREMENT ────────────────────────────────────

# Secret partagé entre woodpecker-server et woodpecker-agent
# Doit être IDENTIQUE sur les deux services
# Générez-le avec : openssl rand -base64 48
# Pour CI/tests uniquement, valeur par défaut fournie (CHANGEZ EN PRODUCTION!)
WOODPECKER_AGENT_SECRET=ci-test-secret-CHANGE-ME-IN-PRODUCTION-min-48-chars-abc123

# OAuth2 Client ID et Client Secret (obtenus dans Forgejo)
# Étapes :
# 1. http://localhost:5333 → créer compte admin
# 2. Avatar → Settings → Applications → New OAuth2 Application
# 3. Nom : Woodpecker CI
# 4. Redirect URI : ${WOODPECKER_HOST}/authorize
# 5. Scope : coche tout ou au moins repo,user:email,read:org
# 6. Créez → copiez Client ID et Client Secret ici
# Pour CI : sera auto-généré par first-run-init.sh
WOODPECKER_FORGEJO_CLIENT=
WOODPECKER_FORGEJO_SECRET=

# ─── CONFIGURATION ADMIN (pour auto-init) ───────────────────────────────────

# Ces variables sont utilisées UNIQUEMENT lors du premier démarrage
# pour créer automatiquement le compte admin et l'app OAuth
# IMPORTANT : Changez ces valeurs en production !

ADMIN_USERNAME=admin
ADMIN_PASSWORD=ChangeMe123!SecurePassword2026
ADMIN_EMAIL=admin@forgejo.local
ADMIN_FULLNAME=Administrator

# ─── VARIABLES OPTIONNELLES (décommenter / remplir si besoin) ───────────────

# Chemin de base pour les volumes persistants sur votre disque
# Par défaut : ./volumes (relatif au docker-compose.yml)
# VOLUMES_BASE=./volumes

# Pour production avec chemin absolu :
# VOLUMES_BASE=/opt/docker/forgejo-woodpecker/volumes